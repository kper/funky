<html lang="en">
<head>
<title>Wolkentreiber</title>
<script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"> </script>
	<link rel="stylesheet" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css">

<style>
	html {
		width: 100%;
		height: 100%;
	}

	.container {
		margin-left: 10%;
		margin-right: 10%;
		display: flex;
		flex-wrap: wrap;
		justify-content: space-around;
	}

	.graph {
		width: 400px;
	}
</style>

<script>

	var parse_to_data = function(data, field) {
			return data.map(x => {
					return {
						label: x.path,
						data: [x[field]],
						fillColor: "rgba(14,72,100,1)"
					}; 
				});
	};

	$(document).ready(function() {
		$.getJSON('http://localhost:5000/commits', function(commits) {
				var perfs = ['cache_misses', 'branch_misses', 'cpu_cycles', 'instructions', 'branch_instructions'];

				perfs.forEach(perf => {
					$.getJSON('http://localhost:5000/' + perf, function(data) {
						var myChart = new Chart(document.getElementById(perf).getContext('2d'), {
							type: 'line',
							data: {
								labels: commits.map(x => x.commit),
								datasets: parse_to_data(data, perf)
							},
							options: {
								scales: {
									yAxes: [{
										ticks: {
											beginAtZero: true
										}
									}]
								}
							}
						});
					});
			});
		});
	});
</script>
	</head>

<h1>Wolkentreiber</h1>

<body>
    <div> 
		<ul>
			{% for item in rows %}
			<li>Commit {{item.commit}} on {{item.on_create}} </li>
    {% endfor %}
		</ul>
    </div>

	<div class="container">
		<div class="graph">
			<canvas id="cache_misses"></canvas>
		</div>

		<div class="graph">
			<canvas id="branch_misses"></canvas>
		</div>

		<div class="graph">
			<canvas id="cpu_cycles"></canvas>
		</div>

		<div class="graph">
			<canvas id="instructions"></canvas>
		</div>

		<div class="graph">
			<canvas id="branch_instructions"></canvas>
		</div>
	</div>

</body>

</html>


